(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["orderPage~roomState"],{"15d2":function(e,o,t){"use strict";var n=t("accd"),r=t.n(n);r.a},"1f9d":function(e,o,t){!function(o,t){e.exports=t()}(window,function(){return function(e){var o={};function t(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=o,t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var r in e)t.d(n,r,function(o){return e[o]}.bind(null,r));return n},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p="",t(t.s=4)}([function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};o.addWrapper=function(e,o){return'<div style="font-family:'+o.font+" !important; font-size: "+o.font_size+' !important; width:100%;">'+e+"</div>"},o.capitalizePrint=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},o.collectStyles=i,o.loopNodesCollectStyles=function e(o,t){for(var n=0;n<o.length;n++){var r=o[n];if(-1===t.ignoreElements.indexOf(r.getAttribute("id"))){var s=r.tagName;if("INPUT"===s||"TEXTAREA"===s||"SELECT"===s){var a=i(r,t),l=r.parentNode,d="SELECT"===s?document.createTextNode(r.options[r.selectedIndex].text):document.createTextNode(r.value),c=document.createElement("div");c.appendChild(d),c.setAttribute("style",a),l.appendChild(c),l.removeChild(r)}else r.setAttribute("style",i(r,t));var m=r.children;m&&m.length&&e(m,t)}else r.parentNode.removeChild(r)}},o.addHeader=function(e,o,t){var n=document.createElement("h1"),r=document.createTextNode(o);n.appendChild(r),n.setAttribute("style",t),e.insertBefore(n,e.childNodes[0])},o.cleanUp=function(e){if(e.showModal&&r.default.close(),e.onLoadingEnd&&e.onLoadingEnd(),(e.showModal||e.onLoadingStart)&&window.URL.revokeObjectURL(e.printable),e.onPrintDialogClose){var o="mouseover";(s.default.isChrome()||s.default.isFirefox())&&(o="focus"),window.addEventListener(o,function t(){window.removeEventListener(o,t),e.onPrintDialogClose()})}};var r=a(t(3)),s=a(t(2));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,o){var t=document.defaultView||window,r="",s=t.getComputedStyle(e,"");return Object.keys(s).map(function(e){(-1!==o.targetStyles.indexOf("*")||-1!==o.targetStyle.indexOf(s[e])||function(e,o){for(var t=0;t<e.length;t++)if("object"===(void 0===o?"undefined":n(o))&&-1!==o.indexOf(e[t]))return!0;return!1}(o.targetStyles,s[e]))&&s.getPropertyValue(s[e])&&(r+=s[e]+":"+s.getPropertyValue(s[e])+";")}),r+="max-width: "+o.maxWidth+"px !important;"+o.font_size+" !important;"}},function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n,r=t(2),s=(n=r)&&n.__esModule?n:{default:n},a=t(0),i={send:function(e,o){document.getElementsByTagName("body")[0].appendChild(o);var t=document.getElementById(e.frameId);"pdf"===e.type&&(s.default.isIE()||s.default.isEdge())?t.setAttribute("onload",l(t,e)):o.onload=function(){if("pdf"===e.type)l(t,e);else{var o=t.contentWindow||t.contentDocument;if(o.document&&(o=o.document),o.body.innerHTML=e.htmlData,"pdf"!==e.type&&null!==e.style){var n=document.createElement("style");n.innerHTML=e.style,o.head.appendChild(n)}"image"===e.type?(r=o,s=e,a=[],s.printable.forEach(function(e,o){return a.push((t=r,n=o,new Promise(function(e){!function o(){var r=t?t.getElementById("printableImage"+n):null;r&&void 0!==r.naturalWidth&&0!==r.naturalWidth?e():setTimeout(o,500)}()})));var t,n}),Promise.all(a)).then(function(){l(t,e)}):l(t,e)}var r,s,a}}};function l(o,t){try{if(o.focus(),s.default.isEdge()||s.default.isIE())try{o.contentWindow.document.execCommand("print",!1,null)}catch(e){o.contentWindow.print()}else o.contentWindow.print()}catch(e){t.onError(e)}finally{(0,a.cleanUp)(t)}}o.default=i},function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n={isFirefox:function(){return"undefined"!=typeof InstallTrigger},isIE:function(){return-1!==navigator.userAgent.indexOf("MSIE")||!!document.documentMode},isEdge:function(){return!n.isIE()&&!!window.StyleMedia},isChrome:function(){return!!(0<arguments.length&&void 0!==arguments[0]?arguments[0]:window).chrome},isSafari:function(){return 0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")||-1!==navigator.userAgent.toLowerCase().indexOf("safari")}};o.default=n},function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n={show:function(e){var o=document.createElement("div");o.setAttribute("style","font-family:sans-serif; display:table; text-align:center; font-weight:300; font-size:30px; left:0; top:0;position:fixed; z-index: 9990;color: #0460B5; width: 100%; height: 100%; background-color:rgba(255,255,255,.9);transition: opacity .3s ease;"),o.setAttribute("id","printJS-Modal");var t=document.createElement("div");t.setAttribute("style","display:table-cell; vertical-align:middle; padding-bottom:100px;");var r=document.createElement("div");r.setAttribute("class","printClose"),r.setAttribute("id","printClose"),t.appendChild(r);var s=document.createElement("span");s.setAttribute("class","printSpinner"),t.appendChild(s);var a=document.createTextNode(e.modalMessage);t.appendChild(a),o.appendChild(t),document.getElementsByTagName("body")[0].appendChild(o),document.getElementById("printClose").addEventListener("click",function(){n.close()})},close:function(){var e=document.getElementById("printJS-Modal");e.parentNode.removeChild(e)}};o.default=n},function(e,o,t){e.exports=t(5)},function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),t(6);var n,r=t(7),s=((n=r)&&n.__esModule?n:{default:n}).default.init;"undefined"!=typeof window&&(window.printJS=s),o.default=s},function(e,o,t){},function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=m(t(2)),s=m(t(3)),a=m(t(8)),i=m(t(9)),l=m(t(10)),d=m(t(11)),c=m(t(12));function m(e){return e&&e.__esModule?e:{default:e}}var u=["pdf","html","image","json","raw-html"];o.default={init:function(){var e={printable:null,fallbackPrintable:null,type:"pdf",header:null,headerStyle:"font-weight: 300;",maxWidth:800,font:"TimesNewRoman",font_size:"12pt",honorMarginPadding:!0,honorColor:!1,properties:null,gridHeaderStyle:"font-weight: bold; padding: 5px; border: 1px solid #dddddd;",gridStyle:"border: 1px solid lightgray; margin-bottom: -1px;",showModal:!1,onError:function(e){throw e},onLoadingStart:null,onLoadingEnd:null,onPrintDialogClose:null,onPdfOpen:null,onBrowserIncompatible:function(){return!0},modalMessage:"Retrieving Document...",frameId:"printJS",htmlData:"",documentTitle:"Document",targetStyle:["clear","display","width","min-width","height","min-height","max-height"],targetStyles:["border","box","break","text-decoration"],ignoreElements:[],imageStyle:"width:100%;",repeatTableHeader:!0,css:null,style:null,scanStyles:!0,base64:!1},o=arguments[0];if(void 0===o)throw new Error("printJS expects at least 1 attribute.");switch(void 0===o?"undefined":n(o)){case"string":e.printable=encodeURI(o),e.fallbackPrintable=e.printable,e.type=arguments[1]||e.type;break;case"object":e.printable=o.printable,e.fallbackPrintable=void 0!==o.fallbackPrintable?o.fallbackPrintable:e.printable,e.type=void 0!==o.type?o.type:e.type,e.frameId=void 0!==o.frameId?o.frameId:e.frameId,e.header=void 0!==o.header?o.header:e.header,e.headerStyle=void 0!==o.headerStyle?o.headerStyle:e.headerStyle,e.maxWidth=void 0!==o.maxWidth?o.maxWidth:e.maxWidth,e.font=void 0!==o.font?o.font:e.font,e.font_size=void 0!==o.font_size?o.font_size:e.font_size,e.honorMarginPadding=void 0!==o.honorMarginPadding?o.honorMarginPadding:e.honorMarginPadding,e.properties=void 0!==o.properties?o.properties:e.properties,e.gridHeaderStyle=void 0!==o.gridHeaderStyle?o.gridHeaderStyle:e.gridHeaderStyle,e.gridStyle=void 0!==o.gridStyle?o.gridStyle:e.gridStyle,e.showModal=void 0!==o.showModal?o.showModal:e.showModal,e.onError=void 0!==o.onError?o.onError:e.onError,e.onLoadingStart=void 0!==o.onLoadingStart?o.onLoadingStart:e.onLoadingStart,e.onLoadingEnd=void 0!==o.onLoadingEnd?o.onLoadingEnd:e.onLoadingEnd,e.onPrintDialogClose=void 0!==o.onPrintDialogClose?o.onPrintDialogClose:e.onPrintDialogClose,e.onPdfOpen=void 0!==o.onPdfOpen?o.onPdfOpen:e.onPdfOpen,e.onBrowserIncompatible=void 0!==o.onBrowserIncompatible?o.onBrowserIncompatible:e.onBrowserIncompatible,e.modalMessage=void 0!==o.modalMessage?o.modalMessage:e.modalMessage,e.documentTitle=void 0!==o.documentTitle?o.documentTitle:e.documentTitle,e.targetStyle=void 0!==o.targetStyle?o.targetStyle:e.targetStyle,e.targetStyles=void 0!==o.targetStyles?o.targetStyles:e.targetStyles,e.ignoreElements=void 0!==o.ignoreElements?o.ignoreElements:e.ignoreElements,e.imageStyle=void 0!==o.imageStyle?o.imageStyle:e.imageStyle,e.repeatTableHeader=void 0!==o.repeatTableHeader?o.repeatTableHeader:e.repeatTableHeader,e.css=void 0!==o.css?o.css:e.css,e.style=void 0!==o.style?o.style:e.style,e.scanStyles=void 0!==o.scanStyles?o.scanStyles:e.scanStyles,e.base64=void 0!==o.base64;break;default:throw new Error('Unexpected argument type! Expected "string" or "object", got '+(void 0===o?"undefined":n(o)))}if(!e.printable)throw new Error("Missing printable information.");if(!e.type||"string"!=typeof e.type||-1===u.indexOf(e.type.toLowerCase()))throw new Error("Invalid print type. Available types are: pdf, html, image and json.");e.showModal&&s.default.show(e),e.onLoadingStart&&e.onLoadingStart();var t=document.getElementById(e.frameId);t&&t.parentNode.removeChild(t);var m=void 0;switch((m=document.createElement("iframe")).setAttribute("style","visibility: hidden; height: 0; width: 0; position: absolute;"),m.setAttribute("id",e.frameId),"pdf"!==e.type&&(m.srcdoc="<html><head><title>"+e.documentTitle+"</title>",null!==e.css&&(Array.isArray(e.css)||(e.css=[e.css]),e.css.forEach(function(e){m.srcdoc+='<link rel="stylesheet" href="'+e+'">'})),m.srcdoc+="</head><body></body></html>"),e.type){case"pdf":if(r.default.isFirefox()||r.default.isEdge()||r.default.isIE())try{console.info("PrintJS currently doesn't support PDF printing in Firefox, Internet Explorer and Edge."),!0===e.onBrowserIncompatible()&&(window.open(e.fallbackPrintable,"_blank").focus(),e.onPdfOpen&&e.onPdfOpen())}catch(o){e.onError(o)}finally{e.showModal&&s.default.close(),e.onLoadingEnd&&e.onLoadingEnd()}else a.default.print(e,m);break;case"image":d.default.print(e,m);break;case"html":i.default.print(e,m);break;case"raw-html":l.default.print(e,m);break;case"json":c.default.print(e,m)}}}},function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n,r=t(1),s=(n=r)&&n.__esModule?n:{default:n},a=t(0);function i(e,o,t){var n=new window.Blob([t],{type:"application/pdf"});n=window.URL.createObjectURL(n),o.setAttribute("src",n),s.default.send(e,o)}o.default={print:function(e,o){if(e.base64)i(e,o,e.printable);else{e.printable=/^(blob|http)/i.test(e.printable)?e.printable:window.location.origin+("/"!==e.printable.charAt(0)?"/"+e.printable:e.printable);var t=new window.XMLHttpRequest;t.responseType="arraybuffer",t.addEventListener("load",function(){if(-1===[200,201].indexOf(t.status))return(0,a.cleanUp)(e),void e.onError(t.statusText);i(e,o,t.response)}),t.open("GET",e.printable,!0),t.send()}}}},function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n,r=t(0),s=t(1),a=(n=s)&&n.__esModule?n:{default:n};o.default={print:function(e,o){var t=document.getElementById(e.printable);if(!t)return window.console.error("Invalid HTML element id: "+e.printable),!1;var n=document.createElement("div");if(n.appendChild(t.cloneNode(!0)),n.setAttribute("style","height:0; overflow:hidden;"),n.setAttribute("id","printJS-html"),t.parentNode.appendChild(n),n=document.getElementById("printJS-html"),!0===e.scanStyles){e.honorMarginPadding&&e.targetStyles.push("margin","padding"),e.honorColor&&e.targetStyles.push("color"),n.setAttribute("style",(0,r.collectStyles)(n,e)+"margin:0 !important;");var s=n.children;(0,r.loopNodesCollectStyles)(s,e)}e.header&&(0,r.addHeader)(n,e.header,e.headerStyle),n.parentNode.removeChild(n),e.htmlData=(0,r.addWrapper)(n.innerHTML,e),a.default.send(e,o)}}},function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n,r=t(0),s=t(1),a=(n=s)&&n.__esModule?n:{default:n};o.default={print:function(e,o){e.htmlData=(0,r.addWrapper)(e.printable,e),a.default.send(e,o)}}},function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n,r=t(0),s=t(1),a=(n=s)&&n.__esModule?n:{default:n};o.default={print:function(e,o){e.printable.constructor!==Array&&(e.printable=[e.printable]);var t,n,s,i=document.createElement("div");i.setAttribute("style","width:100%"),(t=i,n=e,s=[],n.printable.forEach(function(e,o){var r,a,i,l,d=document.createElement("img");d.src=e,s.push((r=t,a=n,i=d,l=o,new Promise(function(e){i.onload=function(){var o=document.createElement("div");o.setAttribute("style",a.imageStyle),i.setAttribute("style","width:100%;"),i.setAttribute("id","printableImage"+l),o.appendChild(i),r.appendChild(o),e()}})))}),Promise.all(s)).then(function(){e.header&&(0,r.addHeader)(i,e.header,e.headerStyle),e.htmlData=i.outerHTML,a.default.send(e,o)})}}},function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=t(0),a=t(1),i=(n=a)&&n.__esModule?n:{default:n};o.default={print:function(e,o){if("object"!==r(e.printable))throw new Error("Invalid javascript data object (JSON).");if("boolean"!=typeof e.repeatTableHeader)throw new Error("Invalid value for repeatTableHeader attribute (JSON).");if(!e.properties||!Array.isArray(e.properties))throw new Error("Invalid properties array for your JSON data.");e.properties=e.properties.map(function(o){return{field:"object"===(void 0===o?"undefined":r(o))?o.field:o,displayName:"object"===(void 0===o?"undefined":r(o))?o.displayName:o,columnSize:"object"===(void 0===o?"undefined":r(o))&&o.columnSize?o.columnSize+";":100/e.properties.length+"%;"}});var t="";e.header&&(t+='<h1 style="'+e.headerStyle+'">'+e.header+"</h1>"),t+=function(e){var o=e.printable,t=e.properties,n='<table style="border-collapse: collapse; width: 100%;">';e.repeatTableHeader&&(n+="<thead>"),n+="<tr>";for(var r=0;r<t.length;r++)n+='<th style="width:'+t[r].columnSize+";"+e.gridHeaderStyle+'">'+(0,s.capitalizePrint)(t[r].displayName)+"</th>";n+="</tr>",e.repeatTableHeader&&(n+="</thead>"),n+="<tbody>";for(var a=0;a<o.length;a++){n+="<tr>";for(var i=0;i<t.length;i++){var l=o[a],d=t[i].field.split(".");if(1<d.length)for(var c=0;c<d.length;c++)l=l[d[c]];else l=l[t[i].field];n+='<td style="width:'+t[i].columnSize+e.gridStyle+'">'+l+"</td>"}n+="</tr>"}return n+"</tbody></table>"}(e),e.htmlData=(0,s.addWrapper)(t,e),i.default.send(e,o)}}}]).default})},"3f5d":function(e,o,t){"use strict";t.r(o);var n=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",e._l(e.payDetails,function(o,n){return t("Row",{key:n},[t("Col",{attrs:{span:24}},[t("Form",{ref:"payForm",refInFor:!0,attrs:{model:o,rules:e.payRule,inline:""}},[t("Icon",{attrs:{type:"logo-yen",size:"24"}}),t("FormItem",{attrs:{prop:"payMethodCode"}},[t("Select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择支付方式"},on:{"on-change":function(e){o.disabled=""===o.payMethodCode}},model:{value:o.payMethodCode,callback:function(t){e.$set(o,"payMethodCode",t)},expression:"item.payMethodCode"}},e._l(e.pay_method,function(o,n){return t("Option",{key:n,attrs:{value:o.dicCommonCode}},[e._v("\n            "+e._s(o.dicCommonName)+"\n          ")])}),1)],1),t("FormItem",{attrs:{prop:"payMoney"}},[t("Input",{staticStyle:{width:"120px"},attrs:{number:"",placeholder:"金额",disabled:o.disabled},on:{"on-change":e.loadMoney},model:{value:o.payMoney,callback:function(t){e.$set(o,"payMoney",t)},expression:"item.payMoney"}})],1),0===n?t("FormItem",[t("Button",{attrs:{type:"error",icon:"md-add",size:"small"},on:{click:e.handleAdd}}),e._v(" \n        "),t("Button",{directives:[{name:"show",rawName:"v-show",value:e.payDetails.length>1,expression:"payDetails.length > 1"}],attrs:{type:"error",icon:"md-remove",size:"small"},on:{click:e.handleRemove}})],1):e._e(),n===e.payDetails.length-1?t("FormItem",[e._v("\n        合计："+e._s(e.total)+"\n      ")]):e._e()],1)],1)],1)}),1)},r=[],s=(t("ac6a"),t("be94")),a=t("52c1"),i={name:"PayDetail",props:{parentIsOpen:Boolean,isCheckOut:Boolean},data(){return{orderIncome:{orderNo:null,incomeTypeCode:"income",incomeClassCode:"receipts",offsetId:null,incomeMoney:0,incomeComment:null,payDetails:[]},payDetails:[{payMethodCode:"",payMoney:null,disabled:!0}],payRule:{payMethodCode:[{required:!0,message:"请选择支付方式"}],payMoney:[{required:!0,message:"请输入金额"},{type:"number",min:1,message:"必须是大于0的数字"}]}}},computed:Object(s["a"])({total(){let e=0;return this.payDetails.forEach(o=>{e+=o.payMoney}),e}},Object(a["e"])({inout:e=>e.dic.inout,pay_method:e=>e.dic.pay_method})),watch:{parentIsOpen(e){e?this.$refs.payForm.forEach(e=>{e.resetFields(),this.isCheckOut&&(this.payRule.payMoney=[{required:!0,message:"请输入金额"},{type:"number",min:0,message:"必须是不小于0的数字"}])}):this.close()}},methods:{handleAdd(){this.payDetails.push({payMethodCode:"",payMoney:null,disabled:!0})},handleRemove(){this.payDetails.length>1&&this.payDetails.pop()},loadMoney(){this.orderIncome.incomeMoney=this.total,this.orderIncome.payDetails=this.payDetails,this.$emit("get-money",this.orderIncome)},close(){Object.assign(this.$data,this.$options.data())}}},l=i,d=t("2877"),c=Object(d["a"])(l,n,r,!1,null,null,null);o["default"]=c.exports},7950:function(e,o,t){},accd:function(e,o,t){},b96f:function(e,o,t){"use strict";var n=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("Modal",{attrs:{width:"900",title:"查看订单","mask-closable":!1},on:{"on-visible-change":e.openOrClose},model:{value:e.isOpen,callback:function(o){e.isOpen=o},expression:"isOpen"}},[t("p",{attrs:{slot:"header"},slot:"header"},[t("Row",[t("Col",{attrs:{span:16}},[e._v("\n        查看订单\n        ")]),t("Col",{attrs:{span:8}},[e._v("\n        订单号："+e._s(e.orderInfo.order.orderNo)+"\n        ")])],1)],1),t("div",[t("Row",[t("Col",{attrs:{span:2}},[e._v(e._s(e.orderInfo.order.guestName))]),t("Col",{attrs:{span:7}},[e._v("\n        证件号："+e._s(e.orderInfo.order.guestCertificateNo)+"\n        ")]),t("Col",{attrs:{span:5}},[e._v("\n        电话："+e._s(e.orderInfo.order.guestTel)+"\n        ")]),t("Col",{attrs:{span:5}},[e._v("\n        渠道："+e._s(e._f("codeToText")(e.orderInfo.order.channelCode))+"\n        "),t("Tag",{attrs:{color:"green"}},[e._v("\n          "+e._s(e._f("codeToText")(e.orderInfo.order.payTypeCode))+"\n        ")])],1),t("Col",{attrs:{span:5}},[e._v("\n        订单号："+e._s(e.orderInfo.order.orderNo)+"\n        ")])],1)],1),e.showReserve?t("div",[t("Divider",{staticStyle:{"margin-top":"0","margin-bottom":"24px"},attrs:{size:"default"}}),t("Table",{staticClass:"orderInfo",attrs:{columns:e.orderReserveCol,data:e.orderInfo.orderReserves,size:"small"},scopedSlots:e._u([{key:"inOutTime",fn:function(o){var t=o.row;return[e._v("\n          "+e._s(new Date(t.estimateInTime).Format("MM-dd"))+" 至\n          "+e._s(e._f("inOutTimeFilter")(t.estimateOutTime))+"\n        ")]}},{key:"action",fn:function(o){var n=o.row;return[n.allottedNum<n.reserveNum?t("a",{on:{click:function(o){e.allotRoom.isAllot="allot",e.allotRoom.orderReserve=n,e.allotRoom.openIs=!0}}},[e._v("分配房间")]):e._e()]}}],null,!1,756167786)},[e._v(" --\x3e\n      ")])],1):e._e(),t("Divider",{staticStyle:{"margin-top":"0","margin-bottom":"24px"},attrs:{size:"default"}}),t("div",[e.orderInfo.orderRooms&&e.orderInfo.orderRooms.length>0?t("Table",{staticClass:"orderInfo",attrs:{columns:e.orderRoomCol,data:e.orderInfo.orderRooms,size:"small"},scopedSlots:e._u([{key:"roomName",fn:function(o){var t=o.row;return[e._v("\n          "+e._s(t.roomName)+" ( "+e._s(t.roomTypeName)+" )\n        ")]}},{key:"orderTypeCode",fn:function(o){var t=o.row;return[e._v("\n          "+e._s(e._f("codeToText")(t.orderTypeCode))+"\n        ")]}},{key:"inOutTime",fn:function(o){var t=o.row;return[e._v("\n          "+e._s(e._f("inOutTimeFilter")(t.realInTime||t.estimateInTime))+" 至\n          "+e._s(e._f("inOutTimeFilter")(t.estimateOutTime))+"\n        ")]}},{key:"state",fn:function(o){var t=o.row;return[e._v("\n          "+e._s(e._f("codeToText")(t.orderRoomStateCode))+"\n        ")]}},{key:"action",fn:function(o){var n=o.row;return[t("Poptip",{attrs:{confirm:"",title:"确认 "+n.roomName+"  退房?",transfer:!0},on:{"on-ok":function(o){return e.roomOut(n.roomNo)}}},["live"===n.orderRoomStateCode?t("a",[e._v("退房")]):e._e()]),e._v("\n           \n          "),"live"===n.orderRoomStateCode?t("a",{on:{click:function(o){return e.openChangeRoom(n)}}},[e._v("换房")]):e._e(),e._v("  \n          "),"no_live"===n.orderRoomStateCode?t("a",{on:{click:function(o){e.allotRoom.isAllot="checkIn",e.allotRoom.checkInOrderRooms[0]=n,e.allotRoom.openIs=!0}}},[e._v("办理入住")]):e._e()]}}],null,!1,2837811300)}):e._e()],1),t("Divider",{staticStyle:{"margin-top":"24","margin-bottom":"24px"}}),t("div",{staticClass:"orderInfo"},[t("Row",{staticStyle:{"margin-bottom":"10px"}},[t("Col",{attrs:{span:18}},[e._v("\n        消费金额：￥"+e._s(e.orderInfo.order.orderMoney)+"元\n        "),t("a",{attrs:{size:"small",type:"text"},on:{click:function(o){e.consumeListIs=!e.consumeListIs,e.getConsume()}}},[e._v(" 查看详情\n          "),e.consumeListIs?t("Icon",{attrs:{type:"ios-arrow-down"}}):t("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),t("Col",{attrs:{span:3}})],1),e.consumeListIs?t("Table",{staticStyle:{"margin-bottom":"10px"},attrs:{columns:e.consumeCol,data:e.orderConsume,size:"small",height:e.consumeTableHeight,"row-class-name":e.rowClassName},scopedSlots:e._u([{key:"consumeMoney",fn:function(o){var n=o.row;return["outgoings"===n.consumeTypeCode?t("span",[e._v("-")]):e._e(),e._v(e._s(n.consumeMoney)+"\n        ")]}},{key:"action",fn:function(o){var n=o.row;return[t("Tooltip",{attrs:{content:"当消费有错误时，进行冲账抵消错误金额",placement:"top"}},["income"===n.consumeTypeCode&&"offset"!==n.consumeItemCode&&(!n.offsetMoney||n.offsetMoney<n.consumeMoney)?t("a",{on:{click:function(o){e.consumeEntry.offsetOrderConsume=n,e.consumeEntry.openIsOffset=!0}}},[e._v("\n              冲账\n            ")]):e._e()])]}},{key:"consumeItemCode",fn:function(o){var t=o.row;return[e._v("\n          "+e._s(e._f("codeToText")(t.consumeItemCode))+"\n        ")]}}],null,!1,2269830432)}):e._e(),t("Row",{staticStyle:{"margin-bottom":"10px"}},[t("Col",{attrs:{span:19}},[e._v("\n        已交金额：￥"+e._s(e.orderInfo.order.payMoney)+"元\n        "),t("a",{attrs:{size:"small",type:"text"},on:{click:function(o){e.incomeListIs=!e.incomeListIs,e.getIncome()}}},[e._v(" 查看详情\n          "),e.incomeListIs?t("Icon",{attrs:{type:"ios-arrow-down"}}):t("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),t("Col",{attrs:{span:5}},[e.balance>=0?t("span",[e._v("余   额：\n          ￥ "),t("span",[e._v(e._s(e.balance))]),e._v(" 元\n        ")]):t("span",[e._v("欠   费：\n          ￥ "),t("span",{staticStyle:{color:"rgb(255, 1, 1)"}},[e._v(e._s(e.balance))]),e._v(" 元\n        ")])])],1),e.incomeListIs?t("Table",{attrs:{columns:e.incomeCol,data:e.orderIncome,size:"small",height:e.incomeTableHeight,"row-class-name":e.rowClassName},scopedSlots:e._u([{key:"incomeTypeCode",fn:function(o){var t=o.row;return[e._v("\n          "+e._s(e._f("codeToText")(t.incomeTypeCode))+"\n        ")]}},{key:"incomeClassCode",fn:function(o){var t=o.row;return[e._v("\n          "+e._s(e._f("codeToText")(t.incomeClassCode))+"\n        ")]}},{key:"incomeMoney",fn:function(o){var n=o.row;return["outgoings"===n.incomeTypeCode?t("span",[e._v("-")]):e._e(),e._v(e._s(n.incomeMoney)+"\n        ")]}},{key:"payDetails",fn:function(o){var n=o.row;return e._l(n.payDetails,function(o,r){return t("span",{key:r},[e._v("\n            "+e._s(e.codeToText(o.payMethodCode))+"："),"outgoings"===n.incomeTypeCode?t("span",[e._v("-")]):e._e(),e._v(e._s(e._f("codeToText")(o.payMoney))+"\n          ")])})}},{key:"action",fn:function(o){var n=o.row;return["offset"!==n.incomeClassCode&&e.isOffset(n.payDetails)?t("a",{on:{click:function(o){e.incomeEntry.incomeClass="offset",e.incomeEntry.offsetIncome=n,e.incomeEntry.openIs=!0}}},[e._v("冲账")]):e._e()]}}],null,!1,2047821195)}):e._e()],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Row",[t("Col",{attrs:{span:10}},[t("Button",{staticStyle:{float:"left"},attrs:{disabled:"completed"===e.orderInfo.order.orderStateCode}},[e._v("取消订单")])],1),t("Col",{attrs:{span:14}},[t("Button",{on:{click:function(o){e.isOpen=!1}}},[e._v("取消")]),t("Button",{on:{click:function(o){e.orderPrint.openIs=!0,e.getIncome()}}},[e._v("打印")]),t("Button",{attrs:{type:"info",disabled:"completed"===e.orderInfo.order.orderStateCode},on:{click:function(o){e.consumeEntry.openIs=!0}}},[e._v("消费入账")]),t("Button",{attrs:{type:"info",disabled:"completed"===e.orderInfo.order.orderStateCode},on:{click:function(o){e.incomeEntry.openIs=!0}}},[e._v("收款")]),t("Button",{attrs:{type:"info",disabled:"completed"===e.orderInfo.order.orderStateCode},on:{click:function(o){e.checkOut.openIs=!0}}},[e._v("结账退房")])],1)],1)],1)],1),t("OrderPrint",{attrs:{"open-is":e.orderPrint.openIs,"print-info":e.orderInfo,orderMoney:e.orderInfo.order.orderMoney,payMoney:e.orderInfo.order.payMoney,incomes:e.orderIncome,balance:e.balance,currIncome:e.printIncome},on:{"order-print-close":function(o){e.orderPrint.openIs=!1}}}),t("ConsumeEntry",{attrs:{"open-is":e.consumeEntry.openIs,"open-is-offset":e.consumeEntry.openIsOffset,"order-rooms":e.orderInfo.orderRooms,"offset-order-consume":e.consumeEntry.offsetOrderConsume},on:{"consume-entry-close":function(o){return e.consumeEntryClose(o)}}}),t("IncomeEntry",{attrs:{"open-is":e.incomeEntry.openIs,"order-no":e.orderInfo.order.orderNo,"income-class":e.incomeEntry.incomeClass,"offset-income":e.incomeEntry.offsetIncome},on:{"income-entry-close":function(o){return e.incomeEntryClose(o)}}}),t("CheckOut",{attrs:{"open-is":e.checkOut.openIs,"order-no":e.orderInfo.order.orderNo,"order-rooms":e.orderInfo.orderRooms,"pay-money":e.balance},on:{"check-out-close":function(o){e.checkOut.openIs=!1},"load-room-state":e.loadRoomState}}),t("ChangeRoom",{attrs:{"open-is":e.changeRoom.openIs,orderRoom:e.changeRoom.orderRoom},on:{"change-room-close":function(o){return e.changeRoomClose(o)}}}),t("AllotRoom",{attrs:{"open-is":e.allotRoom.openIs,"order-reserve":e.allotRoom.orderReserve,order:e.orderInfo.order,"is-allot":e.allotRoom.isAllot,"check-in-order-rooms":e.allotRoom.checkInOrderRooms},on:{"allot-room-close":function(o){return e.allotRoomClose(o)}}})],1)},r=[],s=(t("ac6a"),t("be94")),a=t("52c1"),i=t("f8b7"),l=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("Modal",{style:{maxHeight:"500px"},attrs:{title:"订单打印",width:"280"},on:{"on-visible-change":e.openOrClose},model:{value:e.isOpen,callback:function(o){e.isOpen=o},expression:"isOpen"}},[t("div",{staticClass:"print",staticStyle:{width:"59 mm"},attrs:{id:"printDiv"}},[t("h3",[e._v(e._s(e.currHotel&&e.currHotel.hotelName?e.currHotel.hotelName:""))]),e._v("\n           订单号:\n          "+e._s(e.printInfo.order.orderNo)+" "),t("br"),e.showReserve?t("div",[e._v("\n            ------------------------------"),t("br"),e._v("\n            客人姓名："+e._s(e.printInfo.order.guestName)+" "),t("br"),e._v("\n            预 订 "),t("br"),e._l(e.printInfo.orderReserves,function(o,n){return o.allottedNum<o.reserveNum?t("span",{key:"reserve"+n},[e._v("\n              ------------------------------"),t("br"),e._v("\n              房型："+e._s(o.roomTypeName)+" "),t("br"),e._v("\n              房价："+e._s(o.roomTypePrice)+" 元/间/晚 "),t("br"),e._v("\n              数量："+e._s(o.reserveNum)+" 间 "),t("br"),e._v("\n              入离时间："),t("br"),e._v("\n              "+e._s(new Date(o.estimateInTime).Format("yyyy-MM-dd"))+" 至 "),t("br"),e._v("\n              "+e._s(new Date(o.estimateOutTime).Format("yyyy-MM-dd hh:mm"))+" "),t("br")]):e._e()})],2):e._e(),e._v("\n          ------------------------------"),t("br"),e._l(e.printInfo.orderRooms,function(o,n){return t("span",{key:n},[e._v("\n            客人姓名："+e._s(o.guestName)+" "),t("br"),e._v("\n            房间："+e._s(o.roomName)+"（"+e._s(o.roomTypeName)+"） "),t("br"),e._v("\n            "+e._s("daily"===o.orderTypeCode?"日租房":"钟点房")+" "+e._s(o.roomPrice)+" 元 "),t("br"),e._v("\n            入离时间："),t("br"),e._v("\n            "+e._s(new Date(o.realInTime||o.estimateInTime).Format("yyyy-MM-dd hh:mm"))+" 至 "),t("br"),e._v("\n            "+e._s(new Date(o.estimateOutTime).Format("yyyy-MM-dd hh:mm"))+" "),t("br"),e._v("\n            ------------------------------"),t("br")])}),e._v("\n          已消费： "+e._s(e.orderMoney)+" 元  "),t("br"),e._v("\n          已收款： "+e._s(e.payMoney)+" 元  "),t("br"),e.balance>=0?t("span",[e._v("余   额：")]):t("span",[e._v("欠   费：")]),e._v(" \n          "+e._s(e.balance)+" 元   "),t("br"),e._v("\n          ------------------------------"),t("br"),e.currIncome?e._e():t("div",[e._v("\n             收款详情： "),t("br"),e._l(e.incomes,function(o,n){return t("span",{key:"in"+n},["offset"==o.incomeClassCode?t("span",[e._v("冲减 ")]):e._e(),"refund"==o.incomeClassCode?t("span",[e._v("退款 ")]):e._e(),e._l(o.payDetails,function(o,n){return t("span",{key:"pay"+n},[e._v("\n              "+e._s(o?e.codeToText(o.payMethodCode):"")+" \n              "),"outgoings"==o.payType?t("span",[e._v("-")]):e._e(),e._v("\n              "+e._s(o?o.payMoney:"")+" \n                ")])}),t("br")],2)})],2),e.currIncome?t("span",[e._v("\n            本次收款： "),t("br"),e._l(e.currIncome.payDetails,function(o,n){return t("span",{key:n},[e._v("\n              "+e._s(o?e.codeToText(o.payMethodCode):"")+" "+e._s(o?o.payMoney:"")+"   "),t("br")])})],2):e._e(),e._v("\n          ------------------------------"),t("br"),e._v("\n          打印时间："),t("br"),e._v("\n          "+e._s((new Date).Format("yyyy-MM-dd hh:mm:ss"))+" "),t("br"),e.currUser.realName!==e.printInfo.order.operatorName?t("span",[e._v("打印人："+e._s(e.currUser.realName)+" "),t("br")]):e._e(),e._v("\n          ------------------------------"),t("br"),e._v("\n          操作人："+e._s(e.currIncome?e.currIncome.operatorName:e.printInfo.order.operatorName)+" "),t("br"),t("p",{staticStyle:{font:"1.3em sans-serif"}},[e._v("客人签名：_________________")])],2),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{size:"large"},on:{click:function(o){e.isOpen=!1}}},[e._v("取消")]),t("Button",{attrs:{type:"primary",size:"large",loading:e.printLoad},on:{click:e.print}},[e._v("打印")])],1)])],1)},d=[],c=t("1f9d"),m=t.n(c),u={name:"OrderPrint",props:{openIs:Boolean,printInfo:Object,orderMoney:Number,payMoney:Number,incomes:Array,balance:Number,currIncome:Object},data(){return{isOpen:!1,printLoad:!1}},computed:Object(s["a"])({showReserve(){let e=!1;return this.printInfo.orderReserves&&this.printInfo.orderReserves.length>0&&this.printInfo.orderReserves.forEach(o=>{o.allottedNum<o.reserveNum&&(e=!0)}),e}},Object(a["e"])({currUser:e=>e.user.currUser,currHotel:e=>e.user.currHotel}),Object(a["c"])(["codeToText"])),watch:{openIs(e){this.isOpen=e,console.log(this.printInfo),console.log(this.incomes)}},methods:{openOrClose(e){e?console.log("currIncome:",this.currIncome):this.$emit("order-print-close")},print(){console.log(this.printInfo),m()("printDiv","html")}}},p=u,f=(t("15d2"),t("2877")),h=Object(f["a"])(p,l,d,!1,null,null,null),y=h.exports,g=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("Modal",{attrs:{width:"350",title:e.title,"mask-closable":!1},on:{"on-visible-change":e.openOrClose},model:{value:e.isOpen,callback:function(o){e.isOpen=o},expression:"isOpen"}},[t("Form",{ref:"consumeForm",attrs:{model:e.consumeInfo,rules:e.ruleConsumeInfo,"label-width":80}},[t("FormItem",{attrs:{label:"消费项目",prop:"consumeItemCode"}},[t("Select",{attrs:{placeholder:"选择消费项目"},on:{"on-change":e.getTips},model:{value:e.consumeInfo.consumeItemCode,callback:function(o){e.$set(e.consumeInfo,"consumeItemCode",o)},expression:"consumeInfo.consumeItemCode"}},[t("Option",{attrs:{value:"rent_manual"}},[e._v("手动房租")]),t("Option",{attrs:{value:"commodity"}},[e._v("商品")]),t("Option",{attrs:{value:"cleaning_charge"}},[e._v("清洗费")]),t("Option",{attrs:{value:"damage"}},[e._v("赔偿")]),t("Option",{attrs:{value:"other_consume"}},[e._v("其它")])],1)],1),t("FormItem",{attrs:{label:"消费详情",prop:"consumeItemDetail"}},[t("Input",{attrs:{placeholder:e.tips},model:{value:e.consumeInfo.consumeItemDetail,callback:function(o){e.$set(e.consumeInfo,"consumeItemDetail",o)},expression:"consumeInfo.consumeItemDetail"}})],1),t("FormItem",{attrs:{label:"房 号",prop:"roomNo"}},[t("Select",{attrs:{placeholder:"选择消费房号"},on:{"on-change":e.setRoomName},model:{value:e.consumeInfo.roomNo,callback:function(o){e.$set(e.consumeInfo,"roomNo",o)},expression:"consumeInfo.roomNo"}},e._l(e.orderRooms,function(o,n){return t("Option",{key:n,attrs:{value:o.roomNo}},[e._v(e._s(o.roomName))])}),1)],1),t("FormItem",{attrs:{label:"金 额",prop:"consumeMoney"}},[t("Input",{attrs:{placeholder:"输入金额",number:""},model:{value:e.consumeInfo.consumeMoney,callback:function(o){e.$set(e.consumeInfo,"consumeMoney",o)},expression:"consumeInfo.consumeMoney"}})],1),t("FormItem",{attrs:{label:"备 注"}},[t("Input",{attrs:{placeholder:"输入备注",type:"textarea"},model:{value:e.consumeInfo.consumeComment,callback:function(o){e.$set(e.consumeInfo,"consumeComment",o)},expression:"consumeInfo.consumeComment"}})],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{size:"large"},on:{click:function(o){e.isOpen=!1}}},[e._v("取消")]),t("Button",{attrs:{type:"primary",size:"large",loading:e.loading},on:{click:e.submit}},[e._v("确定")])],1)],1),t("Modal",{attrs:{width:"350",title:"消费冲账","mask-closable":!1},on:{"on-visible-change":e.openOrClose},model:{value:e.isOffsetOpen,callback:function(o){e.isOffsetOpen=o},expression:"isOffsetOpen"}},[t("Form",{ref:"offsetForm",attrs:{model:e.consumeInfo,rules:e.ruleOffsetInfo,"label-width":80}},[t("FormItem",{attrs:{"label-width":0}},[t("h3",[e._v("消费金额："+e._s(e.offsetOrderConsume&&e.offsetOrderConsume.consumeMoney?e.offsetOrderConsume.consumeMoney:"")+" 元   冲账金额不能大于消费金额")])]),t("FormItem",{attrs:{label:"冲账金额",prop:"consumeMoney"}},[t("Input",{attrs:{placeholder:"输入冲账金额",number:""},model:{value:e.consumeInfo.consumeMoney,callback:function(o){e.$set(e.consumeInfo,"consumeMoney",o)},expression:"consumeInfo.consumeMoney"}})],1),t("FormItem",{attrs:{label:"冲账原因",prop:"consumeComment"}},[t("Input",{attrs:{placeholder:"输入冲账原因",type:"textarea"},model:{value:e.consumeInfo.consumeComment,callback:function(o){e.$set(e.consumeInfo,"consumeComment",o)},expression:"consumeInfo.consumeComment"}})],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{size:"large"},on:{click:function(o){e.isOffsetOpen=!1}}},[e._v("取消")]),t("Button",{attrs:{type:"primary",size:"large",loading:e.loading},on:{click:e.offsetSubmit}},[e._v("确定")])],1)],1)],1)},v=[],b={name:"ConsumeEntry",props:{openIs:Boolean,orderRooms:Array,openIsOffset:Boolean,offsetOrderConsume:Object},data(){return{isOpen:!1,isOffsetOpen:!1,title:"消费入账",loading:!1,tips:"请输入消费详情",saveIs:!1,consumeInfo:{orderNo:"",consumeTypeCode:"income",consumeItemCode:"",consumeItemDetail:"",consumeMoney:null,roomName:null,roomNo:null,consumeComment:null,offsetId:null},ruleConsumeInfo:{consumeItemCode:[{required:!0,message:"请选择消费项目"}],consumeItemDetail:[{required:!0,message:"请输入消费详情"}],roomNo:[{required:!0,message:"请选择房号"}],consumeMoney:[{required:!0,message:"请输入金额"},{type:"number",min:1,message:"必须是大于0的数字"}]},ruleOffsetInfo:{consumeMoney:[{required:!0,message:"请输入冲账金额"},{type:"number",min:1,message:"必须是大于0的数字"}],consumeComment:[{required:!0,message:"请输入冲账原因"}]}}},watch:{openIs(e){this.isOpen=e},openIsOffset(e){this.isOffsetOpen=e}},methods:{openOrClose(e){e?(console.log("offsetOrderConsume:",this.offsetOrderConsume),this.$refs.consumeForm.resetFields(),this.title+="--"+this.orderRooms[0].orderNo,this.consumeInfo.orderNo=this.orderRooms[0].orderNo,1===this.orderRooms.length&&(this.consumeInfo.roomNo=this.orderRooms[0].roomNo,this.consumeInfo.roomName=this.orderRooms[0].roomName)):(this.$emit("consume-entry-close",this.saveIs),console.log(this.$options.data()),Object.assign(this.$data,this.$options.data()))},submit(){this.loading=!0,this.$refs.consumeForm.validate(e=>{e?(console.log(this.consumeInfo),Object(i["k"])(this.consumeInfo).then(e=>{0===e.data.code?(this.$Message.success(e.data.msg),this.saveIs=!0,this.isOpen=!1):(this.$Message.error(e.data.code+"："+e.data.msg),this.loading=!1)})):(this.$Message.error("请输入"),this.loading=!1)})},offsetSubmit(){this.loading=!0,this.$refs.offsetForm.validate(e=>{e?(this.consumeInfo.orderNo=this.offsetOrderConsume.orderNo,this.consumeInfo.consumeTypeCode="outgoings",this.consumeInfo.consumeItemCode="offset",this.consumeInfo.offsetId=this.offsetOrderConsume.consumeId,this.consumeInfo.roomName=this.offsetOrderConsume.roomName,this.consumeInfo.roomNo=this.offsetOrderConsume.roomNo,console.log(this.consumeInfo),Object(i["k"])(this.consumeInfo).then(e=>{0===e.data.code?(this.$Message.success(e.data.msg),this.saveIs=!0,this.isOffsetOpen=!1):(this.$Message.error(e.data.code+"："+e.data.msg),this.loading=!1)})):(this.$Message.error("请输入"),this.loading=!1)})},setRoomName(e){let o=this.orderRooms.filter(o=>o.roomNo===e);console.log(o),0!==o.length&&(this.consumeInfo.roomName=o[0].roomName)},getTips(e){switch(e){case"rent":this.tips="如超时房费...等";break;case"commodity":this.tips="如红牛1罐...等";break;case"cleaning_charge":this.tips="如床单/被套...等";break;case"damage":this.tips="如电视/水壶...等";break;default:this.tips="请输入具体情况";break}}}},I=b,_=Object(f["a"])(I,g,v,!1,null,null,null),C=_.exports,O={orderReserveCol:[{title:"房型",key:"roomTypeName",width:90},{title:"房价",key:"roomTypePrice",width:70},{title:"数量",key:"reserveNum",width:80},{title:"已分配",key:"allottedNum",width:80},{title:"时间",slot:"inOutTime",width:200},{title:"操作",slot:"action",align:"center"}],orderRoomCol:[{title:"客人",key:"guestName",width:80},{title:"房间",slot:"roomName",width:140},{title:"类型",slot:"orderTypeCode",width:80},{title:"房价",key:"roomPrice",width:70},{title:"时间",slot:"inOutTime",width:200},{title:"状态",slot:"state",width:80},{title:"操作",slot:"action",align:"center"}],consumeCol:[{type:"index",title:"序号",width:55},{title:"房号",key:"roomName",width:60},{title:"项目",slot:"consumeItemCode",width:85},{title:"详情",key:"consumeItemDetail",width:120},{title:"金额",slot:"consumeMoney",width:80},{title:"时间",key:"gmtCreate",width:165},{title:"操作人",key:"operatorName",width:80},{title:"操作",slot:"action",width:70},{title:"备注",key:"consumeComment"}],incomeCol:[{type:"index",title:"序号",width:55},{title:"类型",slot:"incomeTypeCode",width:60},{title:"项目",slot:"incomeClassCode",width:70},{title:"金额",slot:"incomeMoney",width:70},{title:"支付详情",slot:"payDetails",width:165},{title:"时间",key:"gmtCreate",width:165},{title:"操作人",key:"operatorName",width:75},{title:"操作",slot:"action",width:70},{title:"备注",key:"incomeComment"}]},w=t("cbf3"),M=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("Modal",{attrs:{width:"500",title:e.title,"mask-closable":!1},on:{"on-visible-change":e.openOrClose},model:{value:e.isOpen,callback:function(o){e.isOpen=o},expression:"isOpen"}},["offset"===e.incomeClass?t("Form",{ref:"offsetForm",attrs:{model:e.orderIncome,rules:e.payRule}},[t("FormItem",e._l(e.offsetIncome.payDetails,function(o,n){return t("h3",{key:n},[e._v("\n                "+e._s(e.codeToText(o.payMethodCode))+"："+e._s(o.payMoney)+" 元 \n                可冲减："+e._s(o.offsetMoney?o.payMoney-o.offsetMoney:o.payMoney)+" 元  \n              ")])}),0),e._l(e.orderIncome.payDetails,function(o,n){return t("FormItem",{key:"payDetail"+n,attrs:{label:e.codeToText(o.payMethodCode)+"冲账金额",prop:"payMoney"}},[t("Input",{staticStyle:{width:"200px"},attrs:{number:"",placeholder:"金额，"+e.codeToText(o.payMethodCode)+"不冲账则不填"},model:{value:o.payMoney,callback:function(t){e.$set(o,"payMoney",t)},expression:"item.payMoney"}}),t("span",{staticStyle:{color:"red"}},[e._v(e._s(o.errMsg))])],1)}),e._v("\n        合计："+e._s(e.total)+"\n        "),t("FormItem",{attrs:{label:"冲账原因",prop:"incomeComment"}},[t("Input",{attrs:{placeholder:"输入冲账原因",type:"textarea"},model:{value:e.orderIncome.incomeComment,callback:function(o){e.$set(e.orderIncome,"incomeComment",o)},expression:"orderIncome.incomeComment"}})],1)],2):t("Form",[t("Row",[t("PayDetail",{ref:"payDetail",attrs:{"parent-is-open":e.isOpen},on:{"get-money":e.getMoney}}),t("FormItem",{attrs:{label:"备 注"}},[t("Input",{attrs:{placeholder:"输入备注",type:"textarea"},model:{value:e.orderIncome.incomeComment,callback:function(o){e.$set(e.orderIncome,"incomeComment",o)},expression:"orderIncome.incomeComment"}})],1)],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{size:"large"},on:{click:function(o){e.isOpen=!1}}},[e._v("取消")]),"offset"===e.incomeClass?t("Button",{attrs:{type:"primary",size:"large",loading:e.loading,disabled:!e.isOffsetButton},on:{click:e.offSetSubmit}},[e._v("确定冲账")]):t("Button",{attrs:{type:"primary",size:"large",loading:e.loading},on:{click:e.submit}},[e._v("确定")])],1)],1)],1)},N=[],S=t("3f5d"),k={name:"IncomeEntry",components:{PayDetail:S["default"]},props:{openIs:Boolean,orderNo:String,offsetIncome:Object,incomeClass:String},data(){return{isOpen:!1,title:"收款",loading:!1,saveIs:!1,orderIncome:{orderNo:null,incomeMoney:0,incomeComment:null,payDetails:[]},payRule:{incomeComment:[{required:!0,message:"请输入冲账原因"}]}}},computed:Object(s["a"])({isOffsetButton(){let e=!1;return this.orderIncome.payDetails.forEach(o=>{o&&o.payMoney&&"number"==typeof o.payMoney&&o.payMoney>0?(e=!0,o.errMsg=""):o.errMsg="冲账金额必须大于0的数字",o.payMoney||(o.errMsg="")}),console.log("tag==",e),e},total(){let e=0;return this.orderIncome.payDetails.forEach(o=>{e+=o.payMoney}),e}},Object(a["c"])(["codeToText"])),watch:{openIs(e){this.isOpen=e}},methods:{openOrClose(e){e?"offset"===this.incomeClass&&(console.log("offset"===this.incomeClass),this.offsetIncome.payDetails.forEach(e=>{this.orderIncome.payDetails.push({payMethodCode:e.payMethodCode,offsetId:e.payDetailId,payMoney:null,errMsg:""})}),this.title="收款冲账"):(this.title="收款",this.orderIncome.saveIs=this.saveIs,this.$emit("income-entry-close",this.orderIncome),Object.assign(this.$data,this.$options.data()))},offSetSubmit(){this.orderIncome.payDetails=this.orderIncome.payDetails.filter(e=>e.payMoney),this.orderIncome.orderNo=this.orderNo,this.orderIncome.incomeTypeCode="outgoings",this.orderIncome.incomeClassCode="offset",this.orderIncome.incomeMoney=this.total,this.orderIncome.offsetId=this.offsetIncome.incomeId,console.log(" this.orderIncome",this.orderIncome),this.$refs.offsetForm.validate(e=>{e?(console.log("通过"),Object(i["l"])(this.orderIncome).then(e=>{0===e.data.code?(this.$Message.success(e.data.msg),this.orderIncome=e.data.data,this.saveIs=!0,this.isOpen=!1):(this.$Message.error(e.data.code+"："+e.data.msg),console.log("错误消息",e.data.msg),this.loading=!1)})):console.log("未通过")})},submit(){this.orderIncome.orderNo=this.orderNo,console.log(this.orderIncome),console.log(this.orderIncome.payDetails),console.log(this.$refs.payDetail.$refs.payForm);let e=!1;this.$refs.payDetail.$refs.payForm.forEach(o=>{o.validate(o=>{o?(console.log("通过"),e=!0):(console.log("未通过"),e=!1)})}),e&&Object(i["l"])(this.orderIncome).then(e=>{0===e.data.code?(this.$Message.success(e.data.msg),this.orderIncome=e.data.data,this.saveIs=!0,this.isOpen=!1):(this.$Message.error(e.data.code+"："+e.data.msg),console.log("错误消息",e.data.msg),this.loading=!1)})},getMoney(e){this.orderIncome=e}}},R=k,T=Object(f["a"])(R,M,N,!1,null,null,null),E=T.exports,x=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("Modal",{attrs:{width:"500",title:e.title,"mask-closable":!1},on:{"on-visible-change":e.openOrClose},model:{value:e.isOpen,callback:function(o){e.isOpen=o},expression:"isOpen"}},[t("Form",[e._v("\n          本次退房：\n       "),e._l(e.orderRooms,function(o,n){return t("Row",{key:n},["live"===o.orderRoomStateCode?t("Col",{attrs:{span:24}},[e._v("\n              \n              "+e._s(o.roomName)+" （"+e._s(o.roomTypeName)+"）\n              \n           ")]):e._e()],1)}),t("Row",[t("Col",[e.payMoney<0?t("FormItem",[e._v("\n              已欠费:"),t("span",{staticStyle:{color:"rgb(255, 1, 1)"}},[e._v(e._s(e.payMoney))]),e._v(" 元\n          ")]):t("FormItem",[e._v("\n              应退金额："+e._s(e.payMoney)+" 元\n          ")])],1)],1),t("Row",[t("PayDetail",{ref:"payDetail",attrs:{"parent-is-open":e.isOpen,"is-check-out":!0},on:{"get-money":e.getMoney}})],1)],2),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{size:"large"},on:{click:function(o){e.isOpen=!1}}},[e._v("取消")]),t("Button",{attrs:{type:"primary",size:"large",loading:e.loading},on:{click:e.submit}},[e._v("确定")])],1)],1)],1)},D=[],P={name:"CheckOut",components:{PayDetail:S["default"]},props:{openIs:Boolean,orderNo:String,orderRooms:Array,payMoney:Number},data(){return{isOpen:!1,title:"结账退房",loading:!1,saveIs:!1,checkOut:{orderNo:"",checked:!0,orderIncome:{}},orderIncome:{orderNo:null,incomeMoney:0,incomeComment:null,payDetails:[]}}},watch:{openIs(e){this.isOpen=e}},methods:{openOrClose(e){e||(this.$emit("check-out-close"),Object.assign(this.$data,this.$options.data()))},submit(){if(this.payMoney<0)return this.$Modal.warning({title:"欠费",content:"此订单已欠费，无法结账退房！"}),!1;this.orderIncome.orderNo=this.orderNo;let e=!1;if(this.$refs.payDetail.$refs.payForm.forEach(o=>{o.validate(o=>{o?(console.log("通过"),e=!0):(console.log("未通过"),e=!1)})}),this.checkOut.orderNo=this.orderNo,this.checkOut.orderIncome=this.orderIncome,e){if(this.payMoney!==this.checkOut.orderIncome.incomeMoney)return this.$Modal.warning({title:"警告",content:"金额与应退金额不同，如有消费未入账，请先入账！"}),!1;Object(i["c"])(this.checkOut).then(e=>{0===e.data.code?(this.$emit("load-room-state"),this.$Message.success(e.data.msg),this.isOpen=!1):(this.$Message.error(e.data.code+"："+e.data.msg),this.loading=!1)})}},getMoney(e){this.orderIncome=e}}},$=P,j=Object(f["a"])($,x,D,!1,null,null,null),F=j.exports,L=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("Modal",{attrs:{width:"400",title:"换房","mask-closable":!1,"footer-hide":""},on:{"on-visible-change":e.openOrClose},model:{value:e.isOpen,callback:function(o){e.isOpen=o},expression:"isOpen"}},[t("Form",{ref:"changeForm",attrs:{model:e.changeInfo,rules:e.changeRule}},[t("FormItem",[t("h2",[e._v("旧房号："+e._s(e.orderRoom&&e.orderRoom.roomName?e.orderRoom.roomName:"")+" ")]),t("h2",[e._v("旧房价："+e._s(e.orderRoom&&e.orderRoom.roomPrice?e.orderRoom.roomPrice:"")+" 元")])]),t("FormItem",[t("h3",[e._v("选择新房号：")]),t("SelectRoomNo",{attrs:{width:350,size:"large",rooms:e.roomStates,notRoomNos:e.notRoomNos,isOpen:e.isOpen},on:{"room-no-change":function(o){return e.getCheckedRoom(o)}}})],1),t("FormItem",{attrs:{prop:"newRoomPrice"}},[t("h3",[e._v("输入新房价：")]),t("Input",{attrs:{size:"large",prefix:"md-phone-portrait",placeholder:"请输入新房价",number:""},model:{value:e.changeInfo.newRoomPrice,callback:function(o){e.$set(e.changeInfo,"newRoomPrice",o)},expression:"changeInfo.newRoomPrice"}})],1),t("FormItem",{attrs:{prop:"reason"}},[t("h3",[e._v("输入换房原因：")]),t("Input",{attrs:{size:"large",type:"textarea",prefix:"md-lock",placeholder:"请输入换房原因"},model:{value:e.changeInfo.reason,callback:function(o){e.$set(e.changeInfo,"reason",o)},expression:"changeInfo.reason"}})],1),t("FormItem",[t("Button",{attrs:{size:"large",type:"primary",loading:e.changeLoad,long:""},on:{click:e.submit}},[e._v("确认换房")])],1)],1)],1)],1)},B=[],z=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("Select",{style:{width:e.width?e.width+"px":"auto"},attrs:{filterable:"",placeholder:"请选择房号",size:e.size},on:{"on-change":e.setRoomInfo},model:{value:e.checkedRoomNo,callback:function(o){e.checkedRoomNo=o},expression:"checkedRoomNo"}},e._l(e.isRooms,function(o){return t("Option",{key:o.roomName,attrs:{disabled:e.isDisabled(o.roomNo),value:o.roomNo}},[e._v(e._s(o.roomName)+"-"+e._s(o.roomTypeName)+"\n      ")])}),1)],1)},A=[],H={name:"SelectRoomNo",props:{rooms:Array,defaultRoomNo:String,notRoomNos:Array,isOpen:Boolean,width:Number,size:String},data(){return{checkedRoomNo:null}},computed:{isRooms(){return this.rooms?this.rooms.filter(e=>"vacant"===e.roomState):null}},watch:{isOpen(e){e?(console.log("打开",this.rooms),this.checkedRoomNo=null):console.log("关闭")}},methods:{setRoomInfo(){let e=null;this.rooms&&(e=this.rooms.filter(e=>e.roomNo===this.checkedRoomNo)[0]),this.$emit("room-no-change",e)},isDisabled(e){let o=!1;return!!this.notRoomNos&&(this.notRoomNos.forEach(t=>{e===t&&(o=!0)}),o)}}},W=H,U=Object(f["a"])(W,z,A,!1,null,null,null),q=U.exports,J={name:"ChangeRoom",components:{SelectRoomNo:q},props:{openIs:Boolean,orderNo:String,orderRoom:Object},data(){return{isOpen:!1,changeLoad:!1,notRoomNos:null,changeInfo:{orderRoomId:null,newRoomNo:null,newRoomPrice:null,newRoomTypeName:null,reason:null},changeRule:{newRoomPrice:[{required:!0,message:"请输入新房房价"},{type:"number",min:0,message:"不能小于0"}],reason:[{required:!0,message:"请输入换房原因"}]},isSuccess:!1}},computed:Object(s["a"])({},Object(a["e"])({roomStates:e=>e.room.roomStates})),watch:{openIs(e){this.isOpen=e}},methods:{openOrClose(e){e?(this.notRoomNos=[this.orderRoom.roomNo],console.log(this.roomStates)):(this.$emit("change-room-close",this.isSuccess),Object.assign(this.$data,this.$options.data()))},submit(){this.changeInfo.orderRoomId=this.orderRoom.orderRoomId,console.log(this.changeInfo),this.$refs.changeForm.validate(e=>{e?(this.changeLoad=!0,console.log(this.changeInfo),Object(i["d"])(this.changeInfo).then(e=>{0===e.data.code?(this.$Message.success(e.data.msg),this.isSuccess=!0,this.isOpen=!1):(this.$Message.error(e.data.code+"："+e.data.msg),this.loading=!1)}),this.changeLoad=!1):(this.$Message.error("请输入"),this.changeLoad=!1)})},getCheckedRoom(e){console.log("room",e),this.changeInfo.newRoomNo=e.roomNo,this.changeInfo.newRoomTypeName=e.roomTypeName}}},V=J,X=Object(f["a"])(V,L,B,!1,null,null,null),G=X.exports,K={name:"ViewOrder",components:{OrderPrint:y,ConsumeEntry:C,IncomeEntry:E,CheckOut:F,ChangeRoom:G,AllotRoom:()=>t.e("allotRoom").then(t.bind(null,"145c"))},filters:{inOutTimeFilter(e){return e?new Date(e).Format("MM-dd hh:mm"):""},codeToText(e){return Object(w["a"])(e)}},props:{openIs:Boolean,viewOrderNo:String,isPrint:Boolean},data(){return{isOpen:!1,orderInfo:{order:{channelCode:"",orderNo:"",payTypeCode:""}},orderPrint:{openIs:!1},consumeEntry:{openIs:!1,openIsOffset:!1,offsetOrderConsume:null},incomeEntry:{openIs:!1,incomeClass:"receipts",offsetIncome:null},checkOut:{openIs:!1},changeRoom:{openIs:!1,orderRoom:null},orderRoomCol:O.orderRoomCol,consumeListIs:!1,incomeListIs:!1,consumeCol:O.consumeCol,incomeCol:O.incomeCol,orderConsume:[],orderIncome:[],roomOutInfo:{roomNo:"",orderNo:"",checked:!1},printIncome:null,orderReserveCol:O.orderReserveCol,allotRoom:{openIs:!1,orderReserve:null,isAllot:"allot",checkInOrderRooms:[]}}},computed:Object(s["a"])({consumeTableHeight(){return 4<this.orderConsume.length?215:40*this.orderConsume.length+32},incomeTableHeight(){return this.getTableHeight(this.orderIncome.length)},balance(){return this.orderInfo.order.payMoney-this.orderInfo.order.orderMoney},showReserve(){let e=!1;return this.orderInfo.orderReserves&&this.orderInfo.orderReserves.length>0&&this.orderInfo.orderReserves.forEach(o=>{o.allottedNum<o.reserveNum&&(e=!0)}),e}},Object(a["c"])(["codeToText"])),watch:{openIs(e){this.isOpen=e}},mounted(){},methods:{openOrClose(e){e?(this.getData(),this.isPrint&&(this.getIncome(),this.orderPrint.openIs=!0)):(this.$emit("viewOrderClose"),Object.assign(this.$data,this.$options.data()))},openChangeRoom(e){this.changeRoom.orderRoom=e,this.changeRoom.openIs=!0},getData(){Object(i["g"])(this.viewOrderNo).then(e=>{0===e.data.code?this.orderInfo=e.data.data:this.$Message.error(e.data.code+"："+e.data.msg)})},getConsume(){Object(i["e"])(this.viewOrderNo).then(e=>{0===e.data.code?this.orderConsume=e.data.data:this.$Message.error(e.data.code+"："+e.data.msg)})},getIncome(){Object(i["f"])(this.viewOrderNo).then(e=>{0===e.data.code?this.orderIncome=e.data.data:this.$Message.error(e.data.code+"："+e.data.msg)})},consumeEntryClose(e){this.consumeEntry.openIs=!1,this.consumeEntry.openIsOffset=!1,console.log("event==",e),e&&(this.getData(),this.consumeListIs&&this.getConsume())},incomeEntryClose(e,o){this.incomeEntry.openIs=!1,console.log("event::",e),console.log("inSave::",e.saveIs),this.printIncome=e,e.incomeClassCode&&(this.getData(),!0===e.saveIs&&"receipts"===this.incomeEntry.incomeClass&&(this.orderPrint.openIs=!0),this.incomeListIs&&this.getIncome()),this.incomeEntry.incomeClass="receipts"},changeRoomClose(e){this.changeRoom.openIs=!1,e&&(this.getData(),this.$emit("load-room-state"))},allotRoomClose(e){this.getData(),this.getConsume(),this.allotRoom.openIs=!1,this.$emit("load-room-state")},roomOut(e){this.roomOutInfo.roomNo=e,this.roomOutInfo.orderNo=this.orderInfo.order.orderNo,Object(i["c"])(this.roomOutInfo).then(e=>{0===e.data.code?(this.getData(),this.$emit("load-room-state"),this.$Message.success("退房成功")):this.$Message.error(e.data.code+"："+e.data.msg)})},loadRoomState(){this.getData(),this.$emit("load-room-state")},getTableHeight(e){return 4<e?182:40*e+32},rowClassName(e,o){return"offset"===e.consumeItemCode||"offset"===e.incomeClassCode?"offset-row":""},isOffset(e){console.log("pays= ",e);let o=!1;return e&&e.forEach(e=>{(null===e.offsetMoney||e.offsetMoney&&e.offsetMoney<e.payMoney)&&(o=!0)}),o}}},Q=K,Y=(t("f34e"),Object(f["a"])(Q,n,r,!1,null,null,null));o["a"]=Y.exports},cbf3:function(e,o,t){"use strict";t.d(o,"a",function(){return n});const n=e=>{if(!e)return"";switch(e){case"live":return"正住";case"left":return"已退";case"no_live":return"未入住";case"offline":return"线下客人";case"spot_pay":return"现付";case"advance_pay":return"预付";case"daily":return"日租房";case"hour_room":return"钟点房";case"confirmed":return"已确认";case"completed":return"已完成";case"rent":return"房租";case"rent_manual":return"手动房租";case"commodity":return"商品";case"cleaning_charge":return"清洗费";case"damage":return"赔偿";case"offset":return"冲账";case"income":return"收入";case"outgoings":return"支出";case"receipts":return"收款";case"refund":return"退款";case"deposit":return"订金";case"cash":return"现金";case"wechat":return"微信";default:return e}}},f34e:function(e,o,t){"use strict";var n=t("7950"),r=t.n(n);r.a},f8b7:function(e,o,t){"use strict";t.d(o,"b",function(){return a}),t.d(o,"j",function(){return i}),t.d(o,"a",function(){return l}),t.d(o,"c",function(){return d}),t.d(o,"g",function(){return c}),t.d(o,"h",function(){return m}),t.d(o,"i",function(){return u}),t.d(o,"e",function(){return p}),t.d(o,"k",function(){return f}),t.d(o,"f",function(){return h}),t.d(o,"l",function(){return y}),t.d(o,"d",function(){return g});var n=t("7f43"),r=t.n(n);const s="/api/order",a=e=>{return r.a.post(s+"/checkIn",e)},i=e=>{return r.a.post(s+"/reserve",e)},l=e=>{return r.a.post(s+"/allotRoom",e)},d=e=>{return r.a.post(s+"/checkOut",e)},c=e=>{return r.a.get(s+"/"+e)},m=e=>{return r.a.get(s+"/rooms",{params:e})},u=e=>{return r.a.get(s,{params:e})},p=e=>{return r.a.get(s+"/"+e+"/consume")},f=e=>{return r.a.post(s+"/"+e.oederNo+"/consume",e)},h=e=>{return r.a.get(s+"/"+e+"/income")},y=e=>{return r.a.post(s+"/"+e.oederNo+"/income",e)},g=e=>{return r.a.post(s+"/room/change",e)}}}]);
//# sourceMappingURL=orderPage~roomState.68cc7b2b.js.map