(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["orderReserve"],{eea4:function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("Modal",{attrs:{width:"800",title:"订单预订","mask-closable":!1},on:{"on-visible-change":e.openOrClose},model:{value:e.isOpen,callback:function(t){e.isOpen=t},expression:"isOpen"}},[o("Form",[o("PeopleInfoInput",{attrs:{"parent-is-open":e.isOpen},on:{"get-data":e.getPeopleData}}),o("Divider",{staticClass:"myHr",attrs:{size:"default"}}),o("div",e._l(e.orderReserves,function(t,r){return o("Row",{key:r},[o("Col",{attrs:{span:1}},[o("Icon",{attrs:{type:"md-home",size:"28"}})],1),o("Col",{attrs:{span:4}},[o("FormItem",[o("Select",{staticStyle:{width:"120px"},attrs:{filterable:"",placeholder:"选择房型"},on:{"on-change":function(t){return e.setRoomTypeInfo(r)}},model:{value:t.roomTypeId,callback:function(o){e.$set(t,"roomTypeId",o)},expression:"item.roomTypeId"}},e._l(e.roomTypes,function(t){return o("Option",{key:t.roomTypeId,attrs:{value:t.roomTypeId}},[e._v(e._s(t.roomTypeName)+"\n              ")])}),1)],1)],1),o("Col",{attrs:{span:4}},[o("FormItem",[o("InputNumber",{attrs:{max:100,min:1,placeholder:"预订间数",formatter:function(e){return e+" 间"},parser:function(e){return e.replace(" 间","")}},model:{value:t.reserveNum,callback:function(o){e.$set(t,"reserveNum",o)},expression:"item.reserveNum"}})],1)],1),o("Col",{attrs:{span:4}},[o("FormItem",[o("Input",{staticStyle:{width:"120px"},attrs:{prefix:"logo-yen",placeholder:"请输入房价",number:""},model:{value:t.roomTypePrice,callback:function(o){e.$set(t,"roomTypePrice",o)},expression:"item.roomTypePrice"}})],1)],1),o("Col",{attrs:{span:6}},[o("FormItem",[o("DatePicker",{staticStyle:{width:"75px"},attrs:{type:"date",placement:"bottom-end",placeholder:"时间",format:e.startFormat,options:e.inOptions},on:{"on-change":function(o){return e.setOutTime(r,t.estimateInTime,t.day)}},model:{value:t.estimateInTime,callback:function(o){e.$set(t,"estimateInTime",o)},expression:"item.estimateInTime"}}),e._v("--\n            "),o("DatePicker",{staticStyle:{width:"75px"},attrs:{type:"date",placement:"bottom-end",placeholder:"时间",format:e.endFormat,options:e.outOptions(t.estimateInTime)},on:{"on-change":function(o){return e.setDay(r,t.estimateOutTime)}},model:{value:t.estimateOutTime,callback:function(o){e.$set(t,"estimateOutTime",o)},expression:"item.estimateOutTime"}})],1)],1),o("Col",{attrs:{span:3}},[o("FormItem",[o("InputNumber",{attrs:{max:100,min:1,formatter:function(e){return e+" 晚"},parser:function(e){return e.replace(" 晚","")}},on:{"on-change":function(o){return e.setOutTime(r,t.estimateInTime,o)}},model:{value:t.day,callback:function(o){e.$set(t,"day",o)},expression:"item.day"}})],1)],1),o("Col",{attrs:{span:2}},[0===r?o("FormItem",[o("Button",{attrs:{type:"error",icon:"md-add",size:"small"},on:{click:e.handleAdd}}),e._v(" \n            "),o("Button",{directives:[{name:"show",rawName:"v-show",value:e.orderReserves.length>1,expression:"orderReserves.length > 1"}],attrs:{type:"error",icon:"md-remove",size:"small"},on:{click:e.handleRemove}})],1):e._e()],1)],1)}),1),o("Divider",{staticClass:"myHr",attrs:{size:"default"}}),o("div",[o("Row",[o("Col",{attrs:{span:1}},[o("Icon",{attrs:{type:"md-arrow-forward",size:"28"}})],1),o("Col",{attrs:{span:4}},[o("FormItem",[o("Select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择渠道"},on:{"on-change":e.channelChange},model:{value:e.order.channelCode,callback:function(t){e.$set(e.order,"channelCode",t)},expression:"order.channelCode"}},e._l(e.channel,function(t,r){return o("Option",{key:r,attrs:{value:t.dicCommonCode}},[e._v("\n                "+e._s(t.dicCommonName))])}),1)],1)],1),o("Col",{attrs:{span:8}},[o("FormItem",[o("Select",{staticStyle:{width:"120px"},model:{value:e.order.payTypeCode,callback:function(t){e.$set(e.order,"payTypeCode",t)},expression:"order.payTypeCode"}},[o("Option",{attrs:{value:"spot_pay"}},[e._v("现付")]),o("Option",{attrs:{value:"advance_pay"}},[e._v("预付")])],1)],1)],1)],1)],1),o("Divider",{staticClass:"myHr",attrs:{size:"default"}}),o("div",[o("PayDetail",{attrs:{"parent-is-open":e.isOpen},on:{"get-money":e.getMoney}}),o("FormItem",[o("Input",{attrs:{placeholder:"输入备注",type:"textarea"},model:{value:e.order.orderComment,callback:function(t){e.$set(e.order,"orderComment",t)},expression:"order.orderComment"}})],1)],1)],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{attrs:{size:"large"},on:{click:function(t){e.isOpen=!1}}},[e._v("取消")]),o("Button",{attrs:{type:"primary",size:"large",loading:e.reserveLoad},on:{click:e.submit}},[e._v("确定")])],1)],1)],1)},s=[],a=o("be94"),n=o("52c1"),i=o("f8b7"),l={name:"OrderReserve",props:{openIs:Boolean},components:{PeopleInfoInput:()=>o.e("peopleInfoInput").then(o.bind(null,"4e7f")),PayDetail:()=>Promise.resolve().then(o.bind(null,"3f5d"))},data(){return{isOpen:!1,orderIncome:{incomeMoney:0,incomeTypeCode:"income",incomeComment:null,payDetails:[]},guest:{guestName:null,guestTel:null,certificateType:"idcard",certificateNo:null,guestSex:null,guestNation:null,guestBirthday:null,guestAddress:null},orderReserves:[{roomTypeId:null,roomTypeName:null,roomTypePrice:null,reserveNum:1,estimateInTime:new Date,estimateOutTime:null,day:1}],order:{guestName:"",guestTel:"",guestCertificateNo:"",orderTypeCode:"daily",channelCode:"",payTypeCode:"spot_pay",orderComment:null,clientTypeCode:"web"},reserveLoad:!1,startFormat:"MM-dd",endFormat:"MM-dd HH:mm",defaultDay:1,checkOutHour:12,businessDayEndHour:6,inOptions:{disabledDate(e){return e&&e.valueOf()<Date.now()-864e5}},outDisabledDateTemp:Date.now()-864e5}},computed:Object(a["a"])({},Object(n["e"])({roomTypes:e=>e.room.roomTypes,channel:e=>e.dic.channel})),watch:{openIs(e){this.isOpen=e}},methods:Object(a["a"])({openOrClose(e){e?(this.loadRoomTypes(),this.orderReserves[0].estimateOutTime=this.getCheckOutTime(!1,new Date,1)):(this.$emit("order-reserve-close"),Object.assign(this.$data,this.$options.data()))},outOptions(e){const t=t=>{return t&&t.valueOf()<e.valueOf()};return{disabledDate:t}},getPeopleData(e){this.guest=e},getMoney(e){this.orderIncome=e},setDay(e,t){this.orderReserves[e].day=t.getDate()-this.orderReserves[e].estimateInTime.getDate()},setOutTime(e,t,o){let r=new Date;r.toDateString()===t.toDateString()?t=r:t.setHours(this.businessDayEndHour),this.orderReserves[e].estimateOutTime=this.getCheckOutTime(!1,t,o)},handleAdd(){this.orderReserves.push({roomTypeId:null,roomTypeName:null,roomTypePrice:null,reserveNum:1,estimateInTime:new Date,estimateOutTime:this.getCheckOutTime(!1,new Date,1),day:1})},handleRemove(){this.orderReserves.length>1&&this.orderReserves.pop()},setRoomTypeInfo(e){let t=this.roomTypes.filter(t=>t.roomTypeId===this.orderReserves[e].roomTypeId);t&&t.length>0&&(this.orderReserves[e].roomTypeName=t[0].roomTypeName,this.orderReserves[e].roomTypePrice=t[0].roomTypePrice)},submit(){this.reserveLoad=!0,this.order.guestName=this.guest.guestName;let e=[this.guest],t={order:this.order,orderReserves:this.orderReserves,orderIncome:this.orderIncome,guests:e};Object(i["j"])(t).then(e=>{0===e.data.code?(console.log(e.data.data),this.isOpen=!1,this.$Message.success("预订成功")):(this.$Message.error(e.data.code+"："+e.data.msg),this.reserveLoad=!1)})},getCheckOutTime(e,t,o){let r=new Date(t);return console.log("ssd--",r),e?r.setHours(r.getHours()+o):(r.setDate(r.getDate()+o),r.setHours(this.checkOutHour),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0)),r},channelChange(e){this.order.payTypeCode="offline"===e?"spot_pay":"advance_pay"}},Object(n["b"])(["loadRoomTypes"]))},m=l,d=o("2877"),c=Object(d["a"])(m,r,s,!1,null,null,null);t["default"]=c.exports}}]);
//# sourceMappingURL=orderReserve.90259e55.js.map